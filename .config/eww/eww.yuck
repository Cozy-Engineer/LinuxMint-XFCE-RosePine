
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;
;;                CALENDAR
;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
(defwidget cal []
	(box :class "cal-box" 
		 :orientation "v"
	(box :class "cal-inner-box"
	(calendar :class "cal" 
			  :day calendar_day 
			  :month calendar_month 
			  :year calendar_year))))
(defpoll calendar_day :interval "10h"
    "date '+%d'")
(defpoll calendar_month :interval "10h"
    "scripts/calendar")
(defpoll calendar_year :interval "10h"
    "date '+%Y'")
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;
;;                WORKSPACE
;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
(defwidget workspaces []
  (box :orientation "h"
       :space-evenly false
  (literal :content workspaces_listen)
  (music)))
(deflisten workspaces_listen "scripts/workspace")

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;
;;                 MUSIC
;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
(defvar music_icon "")
(defwidget music []
  (revealer :transition "slideright" 
              :reveal {music_l != ""}
  (box :class "music_box"
       :orientation "h"
       :space-evenly false
  (button :class "previous" 
          :onclick "playerctl previous"
          "󰒮")
  (button :class "play" 
          :onclick "playerctl play-pause;scripts/music_icon"
          music_icon)
  (button :class "stop" 
          :onclick "playerctl stop"
          "")
  (button :class "next" 
          :onclick "playerctl next"
          "󰒭")
  (box :class "music_label"
       :orientation "h"
       :space-evenly false
    {music_l != "" ? "${music_l}" : ""}))))

(deflisten music_l :initial ""
  "scripts/music")
  
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;
;;                 TIME
;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
(defpoll time_val :interval "10s"
  "date '+%d %b  %I:%M %p'")
(defwidget time []
  (button :class "time" 
            :onclick "scripts/calendar"
            time_val))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;
;;                 VOLUME
;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
(defpoll current-volume :interval "1s"
  "scripts/getvol")

(defvar vol_reveal false)
(defvar volume_icon "󰕾 ")

(defwidget volume []
  (box :orientation "h"
       :class "volume"
       :space-evenly false
    (eventbox :onhover "${EWW_CMD} update vol_reveal=true"
              :onhoverlost "${EWW_CMD} update vol_reveal=false"
    (box :space-evenly false
    (button :class "label" 
            :onclick "scripts/volume"
            volume_icon)
    (revealer :transition "slideleft" 
              :reveal vol_reveal
    (scale :min 0
           :max 101
           :active true
           :value current-volume
           :flipped false
           :onchange "amixer set Master {}%; "))
    ))))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;
;;                 WIFI
;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
(defwidget wifi []
	(box		:orientation "h"  
				:tooltip wifi-name
	(button		:onclick "xfce4-terminal -e nmtui --hide-borders --geometry=25x13+1720+20" 
				:class "wifi-icon" wifi-icon)))
(defpoll wifi-icon :interval "1s" "scripts/wifi icon")
(defpoll wifi-name :interval "1s" "scripts/wifi name")

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;
;;                 POWER
;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
(defvar power_reveal false)
(defwidget power []
  (box :orientation "h"
       :class "power"
       :space-evenly false
    (eventbox :onhover "${EWW_CMD} update power_reveal=true"
              :onhoverlost "${EWW_CMD} update power_reveal=false"
    (box :space-evenly false
    (revealer :transition "slideleft" 
              :reveal power_reveal
    (box :space-evenly true
    (button :class "logout" 
            :onclick "xfce4-session-logout --logout -f"
            "󰍃 ")
    (button :class "reboot" 
            :onclick "xfce4-session-logout --reboot -f"
            " ")
    ))
    (button :class "shutdown" 
            :onclick "shutdown now"
            "⏻ ")
    ))))
  
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;
;;                 MAIN
;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
(defwidget bar []
  (centerbox :orientation "h"
    (workspaces)
    (time)
    (sidestuff)))

(defwidget sidestuff []
  (box :class "sidestuff" :orientation "h" :space-evenly false :halign "end"
    (volume)
    (wifi)
    (power)
    ))


(defwindow bar
  :monitor 0
  :windowtype "dock"
  :stacking "bg"
  :exclusive true
  :geometry (geometry :x "0%"
                      :y "0.5%"
                      :width "98%"
                      :height "10px"
                      :anchor "top center")
  :reserve (struts :side "top" :distance "4.3%")
  (bar))
  
;; Calendar Windows ;;
(defwindow calendar
	:geometry (geometry :x "43%" 
						:y "5%" 
						:width "270px" 
						:height "60px")
(cal))
